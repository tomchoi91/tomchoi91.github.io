<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Tom Choi" />


<title>SQL + R</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Dongho Choi</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="research.html">Research/Teaching</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Stat/ML
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="stat2.html">Propensity Score Matching</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Visualization
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="visualization2.html">Milk Production Data Exploration</a>
    </li>
    <li>
      <a href="visualization3.html">Connecting SQL in RStudio/RMarkdown</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fas fa-envelope"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/tomchoi91/">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/tomchoi91/">
    <span class="fab fa-linkedin-in"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">SQL + R</h1>
<h3 class="subtitle">Connecting SQL in RStudio/RMarkdown</h3>
<h4 class="author">Tom Choi</h4>

</div>


<p><img src="https://img.shields.io/badge/Using-SAS-orange" /> <br> <img
src="https://img.shields.io/badge/Using-R-blue" /></p>
<pre class="r"><code>library(RPostgreSQL)
library(RPostgres)
library(flextable)
library(tidyverse)
library(officer)
library(wesanderson)</code></pre>
<pre class="r"><code>con &lt;- dbConnect(RPostgres::Postgres(),
                 host=&#39;localhost&#39;,
                 port=&#39;5432&#39;,
                 dbname=&#39;dvdrental&#39;,
                 user=&#39;postgres&#39;,
                 password=pw)
rm(pw) # removes the password

formats &lt;- list(
  &quot;dod&quot; = function(x) ifelse(is.na(x), x, sprintf(&quot;%.0f%%&quot;, x)),
  &quot;current_day&quot; = function(x) ifelse(is.na(x), x, sprintf(&quot;$%.0f&quot;, x)),
  &quot;prev_day&quot; = function(x) ifelse(is.na(x), x, sprintf(&quot;$%.0f&quot;, x)),
  &quot;film_revenue&quot; = function(x) ifelse(is.na(x), x, sprintf(&quot;$%.0f&quot;, x)),
  &quot;film_revenue_pct&quot; = function(x) ifelse(is.na(x), x, sprintf(&quot;%.0f%%&quot;, x))
  )

std_border = fp_border(color=&quot;gray&quot;)

flextables &lt;- function(data){
    headers &lt;- tibble(col_keys = colnames(data),
                  line1 = colnames(data) %&gt;%
                  recode(
                      &quot;actor_category&quot; = &quot;Category&quot;,
                      &quot;count&quot; = &quot;Count&quot;,
                      &quot;watcher_category&quot; = &quot;Category&quot;,
                      &quot;film_id&quot; = &quot;Film ID&quot;,
                      &quot;film_revenue&quot; = &quot;Total revenue ($)&quot;,
                      &quot;film_revenue_pct&quot; = &quot;Total revenue (%)&quot;,
                      &quot;store_id&quot; = &quot;Store ID&quot;,
                      &quot;date&quot; = &quot;Date&quot;,
                      &quot;current_day&quot; = &quot;Daily revenue&quot;,
                      &quot;prev_day&quot; = &quot;Lag-1 revenue&quot;,
                      &quot;dod&quot; = &quot;DoD growth&quot;
                  )
                  )
    flextable(data) %&gt;%
    {rlang::inject(set_formatter(., !!! formats))} %&gt;%
    set_header_df(mapping = headers, key = &quot;col_keys&quot;) %&gt;%
    theme_booktabs() %&gt;%
    hline(part=&quot;body&quot;, border = std_border ) %&gt;%
    autofit()
}</code></pre>
<div id="database-overview" class="section level2">
<h2>Database overview</h2>
<p><strong>Description</strong></p>
<p>The Sakila Database holds information about a company that rents
movie DVDs. For this project, we will be querying the database to gain
an understanding of the customer base, such as what the patterns in
movie watching are across different customer groups, how they compare on
payment earnings, and how the stores compare in their performance.</p>
<p>And here is the Entity-relationship (ER) diagram for the DVD Rental
database is provided below.</p>
<p><img src="images/erd.png" /></p>
<p><strong>Tables</strong></p>
<ul>
<li><code>actor</code> : contains actors data including first name and
last name</li>
<li><code>film</code> : contains films data such as title, release year,
length, rating, etc</li>
<li><code>film_actor</code> : contains the relationships between films
and actors</li>
<li><code>category</code> : contains film’s categories data</li>
<li><code>film_category</code> : containing the relationships between
films and categories</li>
<li><code>store</code> : contains the store data including manager staff
and address</li>
<li><code>inventory</code> : stores inventory data</li>
<li><code>rental</code> : stores rental data</li>
<li><code>payment</code> : stores customer’s payments</li>
<li><code>staff</code> : stores staff data</li>
<li><code>customer</code> : stores customer’s data</li>
<li><code>address</code> : stores address data for staff and
customers</li>
<li><code>city</code> : stores the city names</li>
<li><code>country</code> : stores the country names</li>
</ul>
<p><strong>Source</strong></p>
<p><a href="https://dev.mysql.com/doc/sakila/en/">Sakila Sample
Database</a></p>
<p><br></p>
</div>
<div id="practice-questions" class="section level2">
<h2>Practice Questions</h2>
<div id="question-13" class="section level3">
<h3>Question 13</h3>
<blockquote>
<p>Please write a query to return the number of actors whose first name
starts with ‘A’, ‘B’, ‘C’, or others. The order of your results doesn’t
matter. You need to return 2 columns:</p>
</blockquote>
<ul>
<li>First column: a group of actors based on the first letter of their
first_name, use the following: <code>a_actors</code>,
<code>b_actors</code>, <code>c_actors</code>, <code>other_actors</code>
to represent their groups.</li>
<li>Second column: the number of actors whose first name matches the
pattern.</li>
</ul>
<pre class="r"><code>q13_dataframe &lt;- dbGetQuery(con, 
&quot;with cte1 as (
    select *, case 
        when first_name like &#39;A%&#39; then &#39;a_actors&#39;
        when first_name like &#39;B%&#39; then &#39;b_actors&#39;
        when first_name like &#39;C%&#39; then &#39;c_actors&#39;
        else &#39;other_actors&#39;
        end as actor_category
    from actor a
)
select actor_category, count(*)
from cte1
group by actor_category
order by actor_category
;&quot;
)

flextables(q13_dataframe)</code></pre>
<template id="c6b202a7-2292-4e76-82dc-e0458e630436"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-dc0c821a{}.cl-dc067d7a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dc071b18{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dc071b19{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dc07561e{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc07561f{width:81.7pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc075620{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc075621{width:81.7pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc075622{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc075623{width:81.7pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc075624{width:81.7pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc075625{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-dc0c821a'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-dc075624"><p class="cl-dc071b18"><span class="cl-dc067d7a">Category</span></p></td><td class="cl-dc075625"><p class="cl-dc071b19"><span class="cl-dc067d7a">Count</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-dc07561f"><p class="cl-dc071b18"><span class="cl-dc067d7a">a_actors</span></p></td><td class="cl-dc07561e"><p class="cl-dc071b19"><span class="cl-dc067d7a"> 13</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dc075621"><p class="cl-dc071b18"><span class="cl-dc067d7a">b_actors</span></p></td><td class="cl-dc075620"><p class="cl-dc071b19"><span class="cl-dc067d7a">  8</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dc075623"><p class="cl-dc071b18"><span class="cl-dc067d7a">c_actors</span></p></td><td class="cl-dc075622"><p class="cl-dc071b19"><span class="cl-dc067d7a"> 18</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dc075621"><p class="cl-dc071b18"><span class="cl-dc067d7a">other_actors</span></p></td><td class="cl-dc075620"><p class="cl-dc071b19"><span class="cl-dc067d7a">161</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="69564901-327c-4277-8483-1a62e04cc9ae"></div>
<script>
var dest = document.getElementById("69564901-327c-4277-8483-1a62e04cc9ae");
var template = document.getElementById("c6b202a7-2292-4e76-82dc-e0458e630436");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code>q13_dataframe %&gt;% mutate(count = as.integer(count)) %&gt;%
    ggplot(aes(x=actor_category, y=count,  
               label=count, vjust=-0.5)) +
    geom_col(fill=wes_palette(&quot;Darjeeling1&quot;, n=4)) +
    scale_y_continuous(expand = expansion(mult = c(0, .2))) +
    xlab(&quot;Category&quot;) +
    ylab(&quot;Count&quot;) +
    geom_text()</code></pre>
<p><img src="visualization3_files/figure-html/unnamed-chunk-2-1.png" width="2100" /></p>
</div>
<div id="question-15" class="section level3">
<h3>Question 15</h3>
<blockquote>
<p>Please write a query to return the number of fast movie watchers vs
slow movie watchers. The orders of your results doesn’t matter. A
customer can only rent one movie per transaction.</p>
</blockquote>
<ul>
<li>fast movie watcher: by average return their rentals within 5
days.</li>
<li>slow movie watcher: takes an average of &gt;5 days to return their
rentals.</li>
<li>Most customers have multiple rentals over time, you need to first
compute the number of days for each rental transaction, then compute the
average on the rounded up days. (e.g., if the rental period is 1 day and
10 hours, count it as 2 days.)</li>
<li>Skip the rentals that have not been returned yet (e.g., rental_date
IS NULL)</li>
</ul>
<pre class="r"><code>q15_dataframe &lt;- dbGetQuery(con, 
&quot;with cte1 as (
    select *, return_date - rental_date as rental_period 
    from rental
),
cte2 as (
    select *, extract(days from rental_period)+1 as rental_days
    from cte1
),
cte3 as (select customer_id, avg(rental_days) avg_rental
    from cte2
    where rental_days is not null
    group by customer_id
)
,
cte4 as (
    select *, case 
    when avg_rental &gt; 5 then &#39;slow movie watcher&#39;
    else &#39;fast movie watcher&#39;
    end watcher_category
    from cte3
--;
)
select watcher_category, count(customer_id)
from cte4
group by watcher_category
;
&quot;
)

flextables(q15_dataframe)</code></pre>
<template id="dd991998-125c-41e5-a19b-95d412530dfa"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-dca12db6{}.cl-dc9adf42{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dc9af716{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dc9af717{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dc9b28b2{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc9b28b3{width:116.5pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc9b28b4{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc9b28b5{width:116.5pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc9b28b6{width:49.9pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dc9b28b7{width:116.5pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-dca12db6'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-dc9b28b7"><p class="cl-dc9af716"><span class="cl-dc9adf42">Category</span></p></td><td class="cl-dc9b28b6"><p class="cl-dc9af717"><span class="cl-dc9adf42">Count</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-dc9b28b3"><p class="cl-dc9af716"><span class="cl-dc9adf42">slow movie watcher</span></p></td><td class="cl-dc9b28b2"><p class="cl-dc9af717"><span class="cl-dc9adf42">487</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dc9b28b5"><p class="cl-dc9af716"><span class="cl-dc9adf42">fast movie watcher</span></p></td><td class="cl-dc9b28b4"><p class="cl-dc9af717"><span class="cl-dc9adf42">112</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="3b880ba3-6298-46d4-8207-08a2195a3659"></div>
<script>
var dest = document.getElementById("3b880ba3-6298-46d4-8207-08a2195a3659");
var template = document.getElementById("dd991998-125c-41e5-a19b-95d412530dfa");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code>q15_dataframe %&gt;% mutate(count = as.integer(count)) %&gt;%
    ggplot(aes(x=watcher_category, y=count, 
               label=count, vjust=-0.5)) +
    geom_col(fill = wes_palette(&quot;Darjeeling2&quot;, n=2)) +
    scale_y_continuous(expand = expansion(mult = c(0, .2))) +
    xlab(&quot;Category&quot;) +
    ylab(&quot;Count&quot;) +
    geom_text()</code></pre>
<p><img src="visualization3_files/figure-html/unnamed-chunk-3-1.png" width="2100" /></p>
</div>
<div id="question-58" class="section level3">
<h3>Question 58</h3>
<blockquote>
<p>Write a query to return the percentage of revenue for each of the
following ﬁlms: film_id &lt;= 10</p>
</blockquote>
<ul>
<li>Formula: revenue (film_id x) * 100.0/ revenue of all movies</li>
<li>The order of your results doesn’t matter</li>
</ul>
<pre class="r"><code>q58_dataframe &lt;- dbGetQuery(con, 
&quot;with cte1 as (
    select distinct film_id, 
    sum(amount) over(partition by film_id) film_revenue
    from payment p
    left join rental r 
    using (rental_id)
    left join inventory i 
    using (inventory_id)
    where film_id &lt;= 10
)
select *, 
    film_revenue *100.0 / sum(film_revenue) over() film_revenue_pct
    from cte1
    order by film_id
;&quot;)

flextables(distinct(q58_dataframe))</code></pre>
<template id="8b763f26-8e70-4d9a-a2ea-ea272e14ec85"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-dd3900c8{}.cl-dd3366f4{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dd338e0e{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dd33b56e{width:104.3pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b56f{width:108pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b570{width:55.4pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b571{width:55.4pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b572{width:104.3pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b573{width:108pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b574{width:55.4pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b575{width:104.3pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dd33b576{width:108pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-dd3900c8'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-dd33b574"><p class="cl-dd338e0e"><span class="cl-dd3366f4">Film ID</span></p></td><td class="cl-dd33b575"><p class="cl-dd338e0e"><span class="cl-dd3366f4">Total revenue ($)</span></p></td><td class="cl-dd33b576"><p class="cl-dd338e0e"><span class="cl-dd3366f4">Total revenue (%)</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-dd33b570"><p class="cl-dd338e0e"><span class="cl-dd3366f4">1</span></p></td><td class="cl-dd33b56e"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$34</span></p></td><td class="cl-dd33b56f"><p class="cl-dd338e0e"><span class="cl-dd3366f4">5%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">2</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$53</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">7%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">3</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$35</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">5%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">4</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$84</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">11%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">5</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$48</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">6%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">6</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$112</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">15%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">7</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$83</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">11%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">8</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$87</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">12%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">9</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$72</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">10%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-dd33b571"><p class="cl-dd338e0e"><span class="cl-dd3366f4">10</span></p></td><td class="cl-dd33b572"><p class="cl-dd338e0e"><span class="cl-dd3366f4">$132</span></p></td><td class="cl-dd33b573"><p class="cl-dd338e0e"><span class="cl-dd3366f4">18%</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="a1c9b773-346f-4e97-901a-19f281c6eec8"></div>
<script>
var dest = document.getElementById("a1c9b773-346f-4e97-901a-19f281c6eec8");
var template = document.getElementById("8b763f26-8e70-4d9a-a2ea-ea272e14ec85");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code>distinct(q58_dataframe) %&gt;%
    ggplot(aes(x=film_id, y=film_revenue, 
               label=sprintf(&quot;$%.0f&quot;, film_revenue), vjust=-0.5)) +
    geom_col(fill = c(wes_palette(&quot;GrandBudapest1&quot;),
                      wes_palette(&quot;GrandBudapest2&quot;),wes_palette(&quot;Rushmore1&quot;, n=2)
                      )) +
    scale_x_continuous(breaks=seq(1, 10, 1)) +
    scale_y_continuous(expand = expansion(mult = c(0, .2))) +
    xlab(&quot;Film ID&quot;) +
    ylab(&quot;Total revenue ($)&quot;) +
    geom_text()</code></pre>
<p><img src="visualization3_files/figure-html/unnamed-chunk-4-1.png" width="2100" /></p>
</div>
<div id="question-80" class="section level3">
<h3>Question 80</h3>
<blockquote>
<p>Please write a query to return DoD(day over day) growth for each
store from April 24, 2007 (inclusive) to April 31, 2007 (inclusive).</p>
</blockquote>
<ul>
<li><code>DoD</code>: (current_day/ prev_day -1) * 100.0</li>
<li>Multiply dod growth to 100.0 to get percentage of growth</li>
<li>Use ROUND to convert dod growth to the nearest integer</li>
</ul>
<pre class="r"><code>q80_dataframe &lt;- dbGetQuery(con, 
&quot;with cte1 as(
    select store_id, 
    date(payment_date) date,
    sum(amount) current_day
    from payment p 
    left join rental r 
    using (rental_id)
    left join inventory i 
    using (inventory_id)
    where payment_date &gt;= &#39;2007-04-01&#39; and payment_date &lt;= &#39;2007-04-30&#39;
    group by store_id, date(payment_date)
),
cte2 as (
    select *, lag(current_day) over(partition by store_id order by date) prev_day
    from cte1
)
select *, round((current_day/prev_day-1)*100.0) DoD
from cte2
;&quot;
)

flextables(q80_dataframe) %&gt;%
    merge_v(j = c(&quot;store_id&quot;)) %&gt;%
    valign(j = c(&quot;store_id&quot;), valign = &quot;top&quot;) %&gt;%
    align(align=&quot;center&quot;, part=&quot;header&quot;)</code></pre>
<template id="f5c64d3d-e9b2-4f93-99f9-5982a8e5f3d9"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-dde3fa1e{}.cl-dddb5fbc{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-dddb5fbd{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dddb5fbe{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dddb5fbf{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-dddb5fc0{width:78.6pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dddb5fc1{width:91.5pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dddb5fc2{width:87.8pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dddb5fc3{width:76.8pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dddb5fc4{width:60.9pt;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dddb5fc5{width:87.8pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-dddb5fc6{width:78.6pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1ee{width:91.5pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1ef{width:60.9pt;background-color:transparent;vertical-align: top;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1f0{width:76.8pt;background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(190, 190, 190, 1.00);border-top: 1pt solid rgba(190, 190, 190, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1f1{width:91.5pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1f2{width:60.9pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1f3{width:87.8pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1f4{width:76.8pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ddddc1f5{width:78.6pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-dde3fa1e'>
<thead><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f2"><p class="cl-dddb5fbd"><span class="cl-dddb5fbc">Store ID</span></p></td><td class="cl-ddddc1f4"><p class="cl-dddb5fbd"><span class="cl-dddb5fbc">Date</span></p></td><td class="cl-ddddc1f3"><p class="cl-dddb5fbd"><span class="cl-dddb5fbc">Daily revenue</span></p></td><td class="cl-ddddc1f1"><p class="cl-dddb5fbd"><span class="cl-dddb5fbc">Lag-1 revenue</span></p></td><td class="cl-ddddc1f5"><p class="cl-dddb5fbd"><span class="cl-dddb5fbc">DoD growth</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td  rowspan="12"class="cl-dddb5fc4"><p class="cl-dddb5fbe"><span class="cl-dddb5fbc">1</span></p></td><td class="cl-dddb5fc3"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-05</span></p></td><td class="cl-dddb5fc2"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$119</span></p></td><td class="cl-dddb5fc1"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc"></span></p></td><td class="cl-dddb5fc0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-06</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1044</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$119</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">779%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-07</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1011</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1044</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-3%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-08</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1135</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1011</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">12%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-09</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$971</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1135</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-15%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-10</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$981</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$971</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">1%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-11</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1029</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$981</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">5%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-12</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$995</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1029</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-3%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-26</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$155</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$995</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-84%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-27</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1309</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$155</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">746%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-28</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1175</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1309</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-10%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-29</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1458</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1175</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">24%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td  rowspan="12"class="cl-ddddc1ef"><p class="cl-dddb5fbe"><span class="cl-dddb5fbc">2</span></p></td><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-05</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$155</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc"></span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-06</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1034</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$155</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">568%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-07</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$974</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1034</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-6%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-08</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1092</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$974</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">12%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-09</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1097</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1092</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">0%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-10</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$993</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1097</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-10%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-11</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$912</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$993</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-8%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-12</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$936</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$912</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">3%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-26</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$193</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$936</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-79%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-27</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1365</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$193</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">609%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-28</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1448</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1365</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">6%</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ddddc1f0"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">2007-04-29</span></p></td><td class="cl-dddb5fc5"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1260</span></p></td><td class="cl-ddddc1ee"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">$1448</span></p></td><td class="cl-dddb5fc6"><p class="cl-dddb5fbf"><span class="cl-dddb5fbc">-13%</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="b2e29f11-dd9e-42db-86a2-cb4ecc242250"></div>
<script>
var dest = document.getElementById("b2e29f11-dd9e-42db-86a2-cb4ecc242250");
var template = document.getElementById("f5c64d3d-e9b2-4f93-99f9-5982a8e5f3d9");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

</div>
</div>


<br><br>
<footer>
  <p class="copyright text-muted" align="center">Copyright &copy; 2022 Dongho Choi</p>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
